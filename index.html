<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Google Trends India â€“ Live RSS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
}

header {
    padding: 15px;
    background: #020617;
    text-align: center;
    border-bottom: 1px solid #1e293b;
}

header h1 {
    margin: 0;
    font-size: 20px;
}

#lastUpdate {
    font-size: 12px;
    color: #94a3b8;
    margin-top: 5px;
}

.container {
    max-width: 900px;
    margin: auto;
    padding: 15px;
}

.trend {
    background: #1e293b; /* Slightly lighter for contrast */
    border-radius: 12px;
    margin-bottom: 18px;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.trend-header {
    display: flex;
    gap: 15px;
    padding: 15px;
}

.trend-header img {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    object-fit: cover;
    background: #334155;
    flex-shrink: 0;
}

.trend-info {
    flex: 1;
}

.trend-info h2 {
    margin: 0 0 6px;
    font-size: 18px;
    color: #fff;
}

.meta {
    font-size: 12px;
    color: #94a3b8;
    margin-bottom: 5px;
}

.badge {
    display: inline-block;
    margin-top: 6px;
    padding: 4px 10px;
    font-size: 11px;
    font-weight: bold;
    border-radius: 20px;
    background: #3b82f6;
    color: white;
}

.news {
    background: #0f172a;
    padding: 10px 15px;
    border-top: 1px solid #334155;
}

.news-item {
    display: flex;
    gap: 12px;
    margin-bottom: 12px;
    text-decoration: none;
    align-items: center;
}

.news-item:last-child {
    margin-bottom: 0;
}

.news-item img {
    width: 50px;
    height: 50px;
    border-radius: 6px;
    object-fit: cover;
    background: #1e293b;
    flex-shrink: 0;
}

.news-content {
    display: flex;
    flex-direction: column;
}

.news-content a {
    color: #38bdf8;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.4;
}

.news-content a:hover {
    text-decoration: underline;
}

.news-content span {
    font-size: 11px;
    color: #94a3b8;
    margin-top: 2px;
}
</style>
</head>

<body>

<header>
    <h1>Google Trends India ðŸ‡®ðŸ‡³ (Live)</h1>
    <div id="lastUpdate">Loadingâ€¦</div>
</header>

<div class="container" id="feed">
    <p style="text-align:center; color: #94a3b8;">Loading trends...</p>
</div>

<script>
// Using AllOrigins as it handles raw text well
const PROXY = "https://api.allorigins.win/raw?url=";
const RSS_URL = "https://trends.google.com/trending/rss?geo=IN&sort=recency";
const REFRESH_TIME = 60000; // 1 minute

// Helper to safely get text content from XML tags
const getVal = (parent, tag) => {
    // Try standard tag name
    let el = parent.getElementsByTagName(tag)[0];
    // Try with namespace prefix if standard fails (some browsers preserve it)
    if (!el) el = parent.getElementsByTagName("ht:" + tag)[0];
    return el ? el.textContent : "";
};

async function loadFeed() {
    try {
        // Encode the URL for the proxy
        const response = await fetch(PROXY + encodeURIComponent(RSS_URL));
        if (!response.ok) throw new Error("Network response was not ok");
        
        const text = await response.text();
        const xml = new DOMParser().parseFromString(text, "text/xml");
        const items = xml.querySelectorAll("item");
        const feed = document.getElementById("feed");

        if (items.length === 0) {
            feed.innerHTML = "<p style='text-align:center'>No trends found (or Google blocked the proxy).</p>";
            return;
        }

        feed.innerHTML = "";

        items.forEach(item => {
            const title = item.querySelector("title")?.textContent || "No Title";
            const pubDate = item.querySelector("pubDate")?.textContent || "";
            // Use helper for namespaced tags
            const traffic = getVal(item, "approx_traffic");
            const image = getVal(item, "picture");
            const imageSource = getVal(item, "picture_source");

            const trendDiv = document.createElement("div");
            trendDiv.className = "trend";

            // Main Card HTML
            let html = `
                <div class="trend-header">
                    <img src="${image}" onerror="this.style.opacity=0">
                    <div class="trend-info">
                        <h2>${title}</h2>
                        <div class="meta">${new Date(pubDate).toLocaleString()}</div>
                        ${traffic ? `<div class="badge">ðŸ”¥ ${traffic}+ searches</div>` : ""}
                        ${imageSource ? `<div class="meta" style="margin-top:5px">Source: ${imageSource}</div>` : ""}
                    </div>
                </div>
                <div class="news">
            `;

            // Process News Items
            const newsItems = item.getElementsByTagName("ht:news_item"); // explicit namespace selector usually works in collection
            // If empty, try without namespace
            const newsList = newsItems.length ? newsItems : item.getElementsByTagName("news_item");

            Array.from(newsList).forEach(n => {
                const nTitle = getVal(n, "news_item_title");
                const nUrl = getVal(n, "news_item_url");
                const nImg = getVal(n, "news_item_picture");
                const nSource = getVal(n, "news_item_source");

                html += `
                    <div class="news-item">
                        ${nImg ? `<img src="${nImg}" onerror="this.style.display='none'">` : ''}
                        <div class="news-content">
                            <a href="${nUrl}" target="_blank">${nTitle}</a>
                            <span>${nSource}</span>
                        </div>
                    </div>
                `;
            });

            html += `</div>`; // Close news
            trendDiv.innerHTML = html;
            feed.appendChild(trendDiv);
        });

        document.getElementById("lastUpdate").textContent =
            "Last updated: " + new Date().toLocaleTimeString();

    } catch (e) {
        document.getElementById("feed").innerHTML =
            `<p style='text-align:center; color:#ef4444'>
                Failed to load feed.<br>
                <small>${e.message}</small>
            </p>`;
        console.error(e);
    }
}

loadFeed();
setInterval(loadFeed, REFRESH_TIME);
</script>

</body>
</html>
